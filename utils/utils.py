import os
import glob
import json


def retrieve(input_dir_path):
    input_dir_path = os.path.join(input_dir_path, "*")
    input_dir_list = glob.glob(input_dir_path)

    file_list = list()
    for path in input_dir_list:
        if os.path.isdir(path):
            file_list += retrieve(path)

        else:
            file_list.append(path)

    return file_list


def get_file_name(file_path):
    file_name = os.path.basename(file_path)
    file_name = os.path.splitext(file_name)[0]

    return file_name


def get_malware_info(path):
    with open(path, "r") as file_descriptor:
        data = json.loads(file_descriptor.read())

    if "Kaspersky" not in data["scans"].keys():
        return None

    try:
        file_type = data["additional_info"]["exiftool"]["FileType"]
    except Exception:
        return None

    result = data["scans"]["Kaspersky"]["result"]
    is_detected = bool(data["scans"]["Kaspersky"]["detected"])
    if not is_detected:
        return "Benign", file_type

    result = result.split(":")[-1]    # remove header
    result = result.split(".")  # separates parent, platform, child
    if len(result) < 3:
        return None

    return str(result[0]).upper(), file_type
